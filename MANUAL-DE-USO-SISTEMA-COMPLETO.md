# 📖 MANUAL DE USO - SISTEMA COMPLETO IA LEADS

## 📋 **ÍNDICE**

1. [👥 Guía de Usuario Final](#guía-de-usuario-final)
2. [👨‍💼 Guía de Administrador](#guía-de-administrador)  
3. [🔧 Guía Técnica](#guía-técnica)
4. [🚀 Flujos de Trabajo](#flujos-de-trabajo)
5. [🆘 Troubleshooting](#troubleshooting)

---

## 👥 **GUÍA DE USUARIO FINAL**

### **🏠 Navegación Principal**

#### **Acceso al Sistema**
1. **URL Principal:** `/clients/leads`
2. **Dashboard Ejecutivo:** `/dashboard`

#### **Estructura de Navegación**
```
📊 Dashboard Ejecutivo (/dashboard)
├── 📈 Resumen - Métricas generales y KPIs
├── 🚀 Analytics IA - Dashboard avanzado con IA
├── ⚡ Tiempo Real - Monitor en tiempo real
├── 📅 Calendario IA - Sistema de agendamiento inteligente
└── 🤖 Auto-Progresión - Motor de progresión automática

📋 Gestión de Leads (/clients/leads)
├── 🎯 Acciones Masivas IA - Funcionalidades avanzadas
├── 📊 Filtros Avanzados - Filtrado inteligente
├── 🎭 Personalización Masiva - Scripts personalizados IA
└── 📈 Vista de Tabla - Gestión individual de leads
```

---

### **🎯 Acciones Masivas IA**

#### **¿Qué son las Acciones Masivas IA?**
Sistema avanzado que permite aplicar acciones inteligentes a múltiples leads simultáneamente usando inteligencia artificial.

#### **Cómo Activar Acciones Masivas IA**

1. **Ir a `/clients/leads`**
2. **Buscar el botón "Acciones Masivas IA"** (color morado)
3. **Hacer clic** → Se abre modal de confirmación
4. **Leer las funcionalidades** que se activarán:
   - ✅ **Selección múltiple** - Seleccionar varios leads a la vez
   - ✅ **Filtros Inteligentes IA** - Filtrar por sentiment, engagement y score  
   - ✅ **Personalización masiva** - Generar scripts personalizados
   - ✅ **Acciones en lote** - Aplicar cambios simultáneos
   - ✅ **Detección automática** - Identificación de leads calificados con IA

5. **Hacer clic en "Activar Acciones Masivas IA"**

#### **Interfaz en Modo Masivo**
Una vez activado, aparecen:
- ☑️ **Checkboxes** en cada lead para selección múltiple
- 🎛️ **Botón "Filtros Inteligentes IA"** - Filtrado avanzado
- 🎯 **Panel de acciones masivas** cuando hay leads seleccionados

---

### **🎛️ Filtros Inteligentes IA**

#### **Acceso**
Solo disponible cuando "Acciones Masivas IA" está **activado**.

#### **Tipos de Filtros**

##### **📊 Filtro por Score de Calificación**
- **Rango:** 0-100
- **Min Score:** Puntuación mínima del lead
- **Max Score:** Puntuación máxima del lead
- **Uso:** Filtrar leads por su nivel de calificación automática

##### **😊 Filtro por Sentiment**
- **Opciones:** Todos / Positivo / Neutral / Negativo
- **Basado en:** Análisis real de conversaciones con IA
- **Uso:** Encontrar leads con actitud específica

##### **🚀 Filtro por Engagement**
- **Opciones:** Todos / Alto / Medio / Bajo  
- **Basado en:** Nivel de interacción y engagement real
- **Uso:** Identificar leads más comprometidos

##### **📅 Filtro por Último Contacto**
- **Opciones:** Días desde último contacto
- **Uso:** Encontrar leads que necesitan seguimiento

#### **Ejemplo de Uso Práctico**
```
Objetivo: Encontrar leads altamente calificados para cierre
Filtros:
✅ Score: Min 70, Max 100
✅ Sentiment: Positivo  
✅ Engagement: Alto
✅ Último contacto: 3-7 días
```

---

### **🎭 Personalización Masiva**

#### **¿Qué es?**
Sistema de IA que genera scripts personalizados únicos para cada lead seleccionado.

#### **Cómo Usar**

1. **Activar "Acciones Masivas IA"**
2. **Seleccionar leads** (hacer clic en checkboxes)
3. **Aparece panel morado** con opción "🎯 Personalización Masiva"
4. **Hacer clic en "Personalización Masiva"**
5. **Se abre modal** con PersonalizationPanel

#### **Funcionalidades del Panel**

##### **🎯 6 Estrategias de Personalización**
1. **Consultivo** - Enfoque consultivo y de asesoría
2. **Directo** - Approach directo al grano
3. **Educativo** - Educar sobre beneficios del producto
4. **Relacional** - Construir relación y confianza
5. **Urgencia** - Crear sentido de urgencia apropiado
6. **Prueba Social** - Usar testimonios y casos de éxito

##### **🎪 8 Objetivos de Llamada**
1. **Prospección** - Llamadas de prospección inicial
2. **Calificación** - Evaluar fit del lead
3. **Demo** - Presentación del producto
4. **Seguimiento** - Follow-up de interacciones
5. **Cierre** - Cerrar la venta
6. **Reactivación** - Reactivar leads fríos
7. **Upselling** - Venta adicional
8. **Cross-selling** - Venta cruzada

##### **🤖 Análisis de Personalidad**
- **Analítico** - Leads que necesitan datos y hechos
- **Conductor** - Leads directos y orientados a resultados  
- **Expresivo** - Leads emocionales y relacionales
- **Amable** - Leads que valoran la relación y confianza

#### **Proceso de Personalización**

1. **Selección de Leads** → Hasta 50 leads simultáneos
2. **Análisis Automático** → IA analiza historial de cada lead
3. **Generación de Scripts** → Script único por lead
4. **Preview Individual** → Ver script de cada lead antes de confirmar
5. **Ejecución** → Generar todos los scripts personalizados

---

### **📊 Dashboard Ejecutivo**

#### **Acceso: `/dashboard`**

#### **Tab 1: 📈 Resumen**
- **Métricas Generales:** Total leads, conversión, score promedio IA
- **Gráficos:** Pipeline, distribución de scores, tendencias
- **Acciones Rápidas:** Links a funciones principales

#### **Tab 2: 🚀 Analytics IA** 
- **Dashboard Avanzado:** Métricas detalladas con IA
- **Análisis Predictivo:** Predicciones de conversión
- **Insights Automáticos:** Recomendaciones de IA

#### **Tab 3: ⚡ Tiempo Real**
- **Monitor en Vivo:** Actividad en tiempo real
- **Alertas:** Notificaciones de eventos importantes
- **Performance:** Métricas de rendimiento actual

#### **Tab 4: 📅 Calendario IA**
- **Vista de Calendario:** Mensual, semanal, diaria
- **Auto-Scheduling:** Programación automática de reuniones
- **Gestión de Eventos:** Crear, editar, completar eventos
- **Detección Inteligente:** IA identifica leads listos para reuniones

#### **Tab 5: 🤖 Auto-Progresión**
- **Motor de Progresión:** Cambios automáticos de estado de leads
- **Reglas Activas:** Configuración de triggers de IA
- **Estadísticas:** Progresiones realizadas y tasa de éxito

---

### **📅 Sistema de Calendario IA**

#### **Funcionalidades Principales**

##### **🤖 Auto-Scheduling**
- **Detección Automática:** IA identifica leads listos para reuniones
- **Programación Inteligente:** Encuentra slots disponibles automáticamente
- **Tipos de Reunión:** Demo, propuesta, cierre, seguimiento

##### **📋 Gestión de Eventos**
- **Crear Eventos:** Manual o automático
- **Outcomes:** Registrar resultados de reuniones
- **Next Actions:** Definir siguientes pasos
- **Follow-ups:** Programar seguimientos automáticos

##### **🎯 Priorización Inteligente**
- **Prioridad Alta:** Leads calificados con sentiment positivo
- **Prioridad Media:** Leads en progresión normal
- **Prioridad Baja:** Leads en nurturing

---

## 👨‍💼 **GUÍA DE ADMINISTRADOR**

### **⚙️ Configuración del Sistema**

#### **Variables de Entorno Críticas**
```bash
# OpenAI Configuration
OPENAI_API_KEY="sk-..."
OPENAI_MODEL="gpt-4o-mini"

# Database
DATABASE_URL="postgresql://..."

# Feature Flags
ENABLE_BULK_SELECTION="true"
ENABLE_SENTIMENT_TIMELINE="true" 
ENABLE_CALENDAR_INTEGRATION="true"
ENABLE_AUTO_PROGRESSION="true"
```

#### **Configuración de Funcionalidades**

##### **🎯 Acciones Masivas**
- **Límite simultáneo:** 50 leads máximo
- **Timeout:** 2 minutos por operación
- **Rate limiting:** 100 requests/minuto

##### **🤖 Auto-Progresión**
- **Intervalo de evaluación:** Cada 30 minutos
- **Confidence threshold:** 75% mínimo
- **Estados permitidos:** Configurables en base de datos

##### **📊 Analytics**
- **Refresh rate:** 30 segundos
- **Data retention:** 90 días
- **Cache duration:** 5 minutos

---

### **📈 Monitoreo y Métricas**

#### **KPIs Principales**
1. **Leads procesados por día**
2. **Tasa de conversión por estrategia de personalización**
3. **Efectividad del auto-scheduling**
4. **Precisión del motor de auto-progresión**
5. **Uso de recursos de IA (tokens OpenAI)**

#### **Alertas Automáticas**
- **Alto uso de recursos:** >80% límite de tokens
- **Errores de API:** >5% tasa de error
- **Performance degradada:** >2s tiempo de respuesta
- **Fallos de auto-progresión:** >10% falsos positivos

---

### **🛡️ Seguridad y Permisos**

#### **Roles y Accesos**
1. **Admin:** Acceso completo a todas las funcionalidades
2. **Manager:** Acceso a analytics y configuración limitada  
3. **User:** Acceso a funcionalidades operativas
4. **Viewer:** Solo lectura de reportes

#### **Auditoría**
- **Logs de acciones masivas:** Registro completo
- **Historial de auto-progresión:** Trazabilidad completa
- **Accesos a datos sensibles:** Monitoreados

---

## 🔧 **GUÍA TÉCNICA**

### **🏗️ Arquitectura del Sistema**

#### **Frontend (Next.js 15.4.4)**
```
app/(private)/
├── clients/leads/ - Gestión principal de leads
├── dashboard/ - Dashboard ejecutivo con 5 tabs
components/
├── leads/ - Componentes de leads
├── analytics/ - Componentes de analytics  
├── calendar/ - Sistema de calendario
├── personalization/ - Personalización IA
lib/
├── services/ - Servicios principales
├── ai/ - Integraciones de IA
hooks/ - Hooks personalizados
types/ - TypeScript types
```

#### **Backend APIs**
```
app/api/
├── leads/ - CRUD y operaciones de leads
├── analytics/ - APIs de analytics y métricas
├── calendar/ - Gestión de calendario
├── calls/ - Personalización y llamadas
```

---

### **🔌 APIs Principales**

#### **Leads Management**
```typescript
// Obtener leads con filtros
GET /api/leads/list?tenantId=X&organizationId=Y&filters=Z

// Análisis de sentiment temporal
GET /api/leads/[id]/conversations/[conversationId]/analysis/sentiment-temporal

// Stats de leads
GET /api/leads/stats?tenantId=X&organizationId=Y
```

#### **Analytics & Dashboard**  
```typescript
// Dashboard analytics
GET /api/analytics/dashboard?tenantId=X&organizationId=Y&period=weekly

// Auto-progression
POST /api/analytics/auto-progression

// Smart reports
GET /api/analytics/smart-reports
```

#### **Calendar System**
```typescript
// Eventos de calendario
GET /api/calendar/events?tenantId=X&organizationId=Y

// Auto-scheduling individual
POST /api/calendar/auto-schedule

// Batch auto-scheduling  
POST /api/calendar/batch-auto-schedule
```

#### **Personalization & Calls**
```typescript
// Personalización individual
POST /api/calls/personalize

// Personalización masiva
POST /api/calls/bulk-personalize  

// Análisis de contexto
POST /api/calls/analyze-context
```

---

### **🤖 Integración con OpenAI**

#### **Modelos Utilizados**
- **GPT-4o-mini:** Análisis principal (costo-efectivo)
- **Configuración:** Temperatura 0.3 para consistencia
- **Context length:** 128k tokens máximo

#### **Tipos de Análisis**
1. **Sentiment Analysis:** Evaluación emocional de conversaciones
2. **Engagement Scoring:** Nivel de interacción del lead
3. **Personalization:** Generación de scripts únicos
4. **Auto-progression:** Evaluación para cambios de estado

#### **Prompts Principales**
```typescript
// Análisis de sentiment temporal
const SENTIMENT_ANALYSIS_PROMPT = `
Analiza el sentiment de esta conversación por segmentos...
`;

// Personalización de scripts
const PERSONALIZATION_PROMPT = `
Genera un script personalizado para este lead...
`;
```

---

### **💾 Base de Datos**

#### **Tablas Principales**
```sql
-- Leads con campos IA
lead: {
  qualificationScore: number (0-100)
  lastSentimentScore: decimal (-1.0 a 1.0)  
  lastEngagementScore: number (0-100)
  responseRate: decimal (0.0-1.0)
  autoProgressionEnabled: boolean
}

-- Análisis de conversaciones
conversationAnalysis: {
  sentimentScore: decimal
  engagementMetrics: jsonb
  temporalAnalysis: jsonb
}

-- Eventos de calendario  
leadCalendarEvent: {
  priority: text
  automated: boolean
  sentimentTrigger: decimal
  outcome: text
  nextAction: text
}
```

#### **Índices Optimizados**
- `idx_leads_qualification_score` - Para filtros de scoring
- `idx_leads_sentiment_engagement` - Para filtros de IA
- `idx_conversation_analysis_lead` - Para análisis temporal
- `idx_calendar_events_date` - Para calendario

---

### **🚀 Deployment**

#### **Requisitos del Sistema**
- **Node.js:** 18+ 
- **PostgreSQL:** 14+
- **RAM:** 2GB mínimo, 8GB recomendado
- **CPU:** 2 cores mínimo, 4 cores recomendado

#### **Variables de Entorno**
```bash
# Core
DATABASE_URL="postgresql://..."
NEXTAUTH_SECRET="..."
NEXTAUTH_URL="https://..."

# OpenAI
OPENAI_API_KEY="sk-..."
OPENAI_MODEL="gpt-4o-mini"

# Feature Flags  
ENABLE_BULK_SELECTION="true"
ENABLE_SENTIMENT_TIMELINE="true"
ENABLE_CALENDAR_INTEGRATION="true"
ENABLE_AUTO_PROGRESSION="true"
```

#### **Build y Deploy**
```bash
npm install
npm run build  # Compila 63 rutas
npm start      # Producción
```

---

## 🚀 **FLUJOS DE TRABAJO**

### **🎯 Flujo 1: Acciones Masivas para Cierre**

#### **Objetivo:** Identificar y procesar leads listos para cierre

```
1. Ir a /clients/leads
2. Activar "Acciones Masivas IA"
3. Activar "Filtros Inteligentes IA"
4. Configurar filtros:
   ✅ Score: 70-100
   ✅ Sentiment: Positivo
   ✅ Engagement: Alto
5. Seleccionar leads filtrados
6. Abrir "Personalización Masiva"
7. Seleccionar:
   ✅ Estrategia: Directo
   ✅ Objetivo: Cierre
   ✅ Personalidad: (IA detecta automáticamente)
8. Generar scripts personalizados
9. Ejecutar llamadas usando scripts generados
```

**Resultado:** Scripts únicos optimizados para cerrar ventas con leads altamente calificados.

---

### **📅 Flujo 2: Agendamiento Automático**

#### **Objetivo:** Programar reuniones automáticamente con leads calificados  

```
1. Ir a /dashboard
2. Click en tab "📅 Calendario IA"
3. Sistema detecta automáticamente leads listos para reuniones
4. Click en "Auto-Schedule" para leads sugeridos
5. IA programa reuniones en slots disponibles
6. Sistema envía invitaciones automáticamente
7. Seguimiento automático de outcomes
```

**Resultado:** Reuniones programadas automáticamente con leads en el momento óptimo.

---

### **🤖 Flujo 3: Auto-Progresión de Leads**

#### **Objetivo:** Progresión automática basada en análisis de IA

```
1. Sistema analiza conversaciones cada 30 minutos
2. Evalúa sentiment, engagement y behavioral patterns
3. Aplica reglas de auto-progresión:
   ✅ Sentiment positivo + engagement alto → Progresión
   ✅ Múltiples no-respuestas → Degradación 
   ✅ Buying signals detectados → Aceleración
4. Cambios automáticos de estado
5. Notificaciones a agentes sobre cambios
6. Registro de auditoría completo
```

**Resultado:** Leads progresan automáticamente sin intervención manual.

---

### **📊 Flujo 4: Análisis y Optimización**

#### **Objetivo:** Monitorear y optimizar performance del sistema

```
1. Ir a /dashboard → "🚀 Analytics IA"
2. Revisar métricas clave:
   ✅ Conversión por estrategia de personalización
   ✅ Efectividad de auto-scheduling  
   ✅ Precisión de auto-progresión
3. Identificar patrones y oportunidades
4. Ajustar configuraciones basándose en datos
5. Ir a "⚡ Tiempo Real" para monitoreo continuo
```

**Resultado:** Optimización continua basada en datos reales de performance.

---

## 🆘 **TROUBLESHOOTING**

### **❌ Problemas Comunes**

#### **🚫 "Acciones Masivas IA" no aparece**
**Causa:** Feature flag desactivado
**Solución:** 
```bash
export ENABLE_BULK_SELECTION="true"
npm restart
```

#### **📊 Filtros no funcionan correctamente**  
**Causa:** Datos de sentiment/engagement no disponibles
**Solución:**
1. Verificar que leads tengan conversaciones analizadas
2. Ejecutar análisis de sentiment: `POST /api/leads/[id]/conversations/[conversationId]/analysis/sentiment`

#### **🎭 PersonalizationPanel no carga**
**Causa:** API key de OpenAI inválida o límite excedido
**Solución:**
1. Verificar `OPENAI_API_KEY` en environment variables
2. Revisar límites de uso en OpenAI dashboard
3. Verificar logs: `console.error` en browser

#### **📅 Calendario no muestra eventos**
**Causa:** Permisos o datos de calendario faltantes  
**Solución:**
1. Verificar `ENABLE_CALENDAR_INTEGRATION="true"`
2. Verificar permisos de usuario
3. Revisar tabla `leadCalendarEvent` en base de datos

#### **🤖 Auto-progresión no funciona**
**Causa:** Motor desactivado o reglas mal configuradas
**Solución:**
1. Verificar `ENABLE_AUTO_PROGRESSION="true"`
2. Revisar reglas en `/dashboard` → "🤖 Auto-Progresión"
3. Verificar logs del motor: `lib/services/autoProgressionEngine.ts`

---

### **🔧 Comandos de Debug**

#### **Verificar Estado del Sistema**
```bash
# Test de build
npm run build

# Validación de componentes  
node test-system-validation.js

# Test de auto-progresión
node test-autoprogression.js

# Logs en tiempo real
tail -f logs/application.log
```

#### **Database Debugging**
```sql
-- Verificar leads con datos IA
SELECT id, name, qualificationScore, lastSentimentScore, lastEngagementScore 
FROM lead WHERE qualificationScore IS NOT NULL;

-- Verificar análisis de conversaciones
SELECT * FROM conversationAnalysis ORDER BY createdAt DESC LIMIT 10;

-- Verificar eventos de calendario
SELECT * FROM leadCalendarEvent ORDER BY scheduledAt DESC LIMIT 10;
```

#### **API Testing**
```bash
# Test de leads API
curl "http://localhost:3000/api/leads/list?tenantId=test&organizationId=test"

# Test de analytics
curl "http://localhost:3000/api/analytics/dashboard?tenantId=test&organizationId=test"

# Test de personalización  
curl -X POST "http://localhost:3000/api/calls/personalize" \
  -H "Content-Type: application/json" \
  -d '{"leadIds":["test"],"strategy":"consultive","objective":"demo"}'
```

---

### **📞 Soporte Técnico**

#### **Niveles de Soporte**
1. **L1 - Usuario:** Manual de uso, FAQs
2. **L2 - Administrador:** Configuración, monitoreo  
3. **L3 - Técnico:** Debug, desarrollo, base de datos

#### **Escalación**
- **Issues de usuario:** Revisar manual y configuraciones
- **Performance issues:** Revisar métricas y logs
- **Bugs técnicos:** Revisar código y realizar debugging

---

**📚 Este manual cubre el uso completo del sistema IA Leads. Para actualizaciones y nuevas funcionalidades, consultar la documentación técnica en el repositorio.**

**🔄 Última actualización:** 28 de Agosto, 2025  
**📊 Versión del sistema:** 1.0.0 - Todas las fases implementadas